<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crossy Road - Rabbit vs Lions</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
        }
        canvas {
            display: block;
        }
        #scoreboard {
            position: absolute;
            top: 10px;
            left: 10px;
            font-family: Arial, sans-serif;
            font-size: 20px;
            color: white;
            background: rgba(0, 0, 0, 0.5);
            padding: 10px;
            border-radius: 5px;
        }
        #startButton {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding: 20px;
            font-size: 24px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
        }
        #startButton:hover {
            background-color: #45a049;
        }
    </style>
</head>
<body>
<canvas id="gameCanvas"></canvas>
<div id="scoreboard">
    Score: <span id="score">0</span> | High Score: <span id="highScore">0</span> | Game Speed: <span id="gameSpeedDisplay">1</span>
    <br><button onclick="resetHighScore()">Reset High Score</button>
</div>

<button id="startButton" onclick="startGame()">Start Game</button>

<audio id="backgroundMusic" src="cyber_monster_world_sound.mp3" loop></audio>

<script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    const rabbitImg = new Image();
    rabbitImg.src = "Anime-style_baby_rabbit_character,_standing_cutely.png";
    
    const lionImg = new Image();
    lionImg.src = "Anime-style_evil_lion_character,_standing_menacing.png";

    let rabbit = { x: 50, y: canvas.height - 100, width: 50, height: 50, speed: 5, sprintSpeed: 12, isSprinting: false };

    // Illustration background settings
    let backgroundY = 0;
    let backgroundSpeed = 1;  // Speed of the background scrolling

    function drawBackground() {
        ctx.fillStyle = "#87CEEB"; // Sky blue
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        // Draw simple buildings
        ctx.fillStyle = "#2F4F4F";  // Dark gray buildings
        for (let i = 0; i < 5; i++) {
            let buildingX = i * 200;  // Space between buildings horizontally
            let buildingY = (backgroundY + i * 300) % canvas.height;  // Scroll effect vertically
            let buildingHeight = 200 + (i % 2) * 100;  // Different heights for buildings

            ctx.fillRect(buildingX, buildingY, 100, buildingHeight);  // Draw first row of buildings
            ctx.fillRect(buildingX + 300, buildingY - 400, 100, buildingHeight + 150); // Second row
        }

        // Scroll the background upwards
        backgroundY += backgroundSpeed;
        if (backgroundY > canvas.height) {
            backgroundY = 0;  // Loop the background back to the top
        }
    }

    let lions = [
        { x: 100, y: 0, width: 50, height: 50, speed: 3 },
        { x: 300, y: 0, width: 50, height: 50, speed: 4 },
        { x: 500, y: 0, width: 50, height: 50, speed: 2 }
    ];

    let score = 0, highScore = 0, gameSpeed = 1, scoreMultiplier = 1, gameRunning = false;
    let maxLions = 7;  // Maximum number of lions
    let touchX = rabbit.x, touchY = rabbit.y;

    const backgroundMusic = document.getElementById("backgroundMusic");

    function updateScore() {
        document.getElementById('score').textContent = score;
        document.getElementById('highScore').textContent = highScore;
        document.getElementById('gameSpeedDisplay').textContent = gameSpeed.toFixed(1);  // Display current game speed
    }

    function resetHighScore() {
        highScore = 0;
        updateScore();
    }

    function moveRabbit() {
        if (!gameRunning) return;

        if (touchX > rabbit.x) rabbit.x += rabbit.speed;
        if (touchX < rabbit.x) rabbit.x -= rabbit.speed;
        if (touchY > rabbit.y) rabbit.y += rabbit.speed;
        if (touchY < rabbit.y) rabbit.y -= rabbit.speed;
    }

    function moveLions() {
        if (!gameRunning) return;
        lions.forEach(lion => {
            lion.y += lion.speed * gameSpeed;  // Lions move faster as gameSpeed increases

            if (lion.y > canvas.height) {
                lion.y = 0;  // Reset lion to the top of the canvas
                lion.x = Math.random() * canvas.width;  // Random horizontal position
                score += 1;  // Increase the score
                if (score > highScore) highScore = score;
                updateScore();

                if (lions.length < maxLions && score % 10 === 0) {
                    addLion();  // Add more lions as the score increases
                }

                if (score % getRandomMultiplier() === 0) {  // Randomly increase game speed when score is a multiple of 5, 6, or 7
                    increaseDifficulty();  
                }
            }
        });
    }

    function addLion() {
        const newLion = {
            x: Math.random() * canvas.width,
            y: 0,
            width: 50,
            height: 50,
            speed: Math.random() * 3 + 2  // Random speed for new lion
        };
        lions.push(newLion);
    }

    function increaseDifficulty() {
        gameSpeed += 0.2;  // Increase the game speed by 0.2
        backgroundSpeed += 0.1;  // Optionally, also increase background speed for dynamic effect
        updateScore();  // Update display to show the increased game speed
    }

    // Function to randomly choose between 5, 6, or 7 as the score multiplier
    function getRandomMultiplier() {
        const multipliers = [5, 6, 7];
        return multipliers[Math.floor(Math.random() * multipliers.length)];
    }

    function checkCollision(rabbit, lion) {
        return rabbit.x < lion.x + lion.width &&
               rabbit.x + rabbit.width > lion.x &&
               rabbit.y < lion.y + lion.height &&
               rabbit.y + rabbit.height > lion.y;
    }

    function drawRabbit() {
        ctx.drawImage(rabbitImg, rabbit.x, rabbit.y, rabbit.width, rabbit.height);
    }

    function drawLions() {
        lions.forEach(lion => {
            ctx.drawImage(lionImg, lion.x, lion.y, lion.width, lion.height);
        });
    }

    function endGame() {
        gameRunning = false;
        if (score > highScore) highScore = score;
        updateScore();
        setTimeout(() => {
            if (confirm("A lion caught the rabbit! Would you like to start a new game?")) {
                resetGame();
            }
        }, 100);
    }

    function resetGame() {
        score = 0;
        gameSpeed = 1;  // Reset gameSpeed to its initial value
        backgroundSpeed = 1;  // Reset background speed
        scoreMultiplier = 1;
        rabbit.x = 50;
        rabbit.y = canvas.height - 100;
        lions = [
            { x: 100, y: 0, width: 50, height: 50, speed: 3 },
            { x: 300, y: 0, width: 50, height: 50, speed: 4 },
            { x: 500, y: 0, width: 50, height: 50, speed: 2 }
        ];  // Reset to 3 lions
        gameRunning = true;
        updateScore();
    }

    function startGame() {
        gameRunning = true;
        backgroundMusic.play();
        document.getElementById("startButton").style.display = "none";
    }

    function handleTouchMove(evt) {
        const touch = evt.touches[0];
        touchX = touch.clientX - rabbit.width; 
        touchY = touch.clientY - rabbit.height * 2; 
    }

    function handleTouchEnd() {
        touchX = rabbit.x;
        touchY = rabbit.y;
    }

    function gameLoop() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        drawBackground();  // Draw scrolling background

        if (gameRunning) {
            moveRabbit();
            moveLions();
            drawRabbit();
            drawLions();

            lions.forEach(lion => {
                if (checkCollision(rabbit, lion)) {
                    endGame();
                }
            });
        }
        requestAnimationFrame(gameLoop);
    }

    canvas.addEventListener("touchmove", handleTouchMove);
    canvas.addEventListener("touchend", handleTouchEnd);

    gameLoop();
</script>
</body>
</html>
