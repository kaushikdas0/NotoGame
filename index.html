<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crossy Road - Rabbit vs Lions</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
        }
        canvas {
            display: block;
            background-color: #87CEEB;
        }
        #scoreboard {
            position: absolute;
            top: 10px;
            left: 10px;
            font-family: Arial, sans-serif;
            font-size: 20px;
            color: white;
            background: rgba(0, 0, 0, 0.5);
            padding: 10px;
            border-radius: 5px;
        }
        #startButton {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding: 20px;
            font-size: 24px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
        }
        #startButton:hover {
            background-color: #45a049;
        }
    </style>
</head>
<body>
<canvas id="gameCanvas"></canvas>
<div id="scoreboard">
    Score: <span id="score">0</span> | High Score: <span id="highScore">0</span>
    <br><button onclick="resetHighScore()">Reset High Score</button>
</div>

<button id="startButton" onclick="startGame()">Start Game</button>

<audio id="backgroundMusic" src="cyber_monster_world_sound.mp3" loop></audio>

<script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    const rabbitImg = new Image();
    rabbitImg.src = "Anime-style_baby_rabbit_character,_standing_cutely.png";
    
    const lionImg = new Image();
    lionImg.src = "Anime-style_evil_lion_character,_standing_menacing.png";

    let rabbit = { x: 50, y: canvas.height - 100, width: 50, height: 50, speed: 5, sprintSpeed: 12, isSprinting: false };
    let lions = [
        { x: 100, y: 0, width: 50, height: 50, speed: 3 },
        { x: 300, y: 0, width: 50, height: 50, speed: 4 },
        { x: 500, y: 0, width: 50, height: 50, speed: 2 }
    ];

    let keys = {}, score = 0, highScore = 0, gameSpeed = 1, scoreMultiplier = 1, gameRunning = false;
    let touchStartX = 0, touchStartY = 0;

    const backgroundMusic = document.getElementById("backgroundMusic");

    function updateScore() {
        document.getElementById('score').textContent = score;
        document.getElementById('highScore').textContent = highScore;
    }

    function resetHighScore() {
        highScore = 0;
        updateScore();
    }

    function moveRabbit() {
        if (!gameRunning) return;
        if (keys["ArrowUp"] && rabbit.y > 0) rabbit.y -= rabbit.isSprinting ? rabbit.sprintSpeed : rabbit.speed;
        if (keys["ArrowDown"] && rabbit.y < canvas.height - rabbit.height) rabbit.y += rabbit.isSprinting ? rabbit.sprintSpeed : rabbit.speed;
        if (keys["ArrowLeft"] && rabbit.x > 0) rabbit.x -= rabbit.isSprinting ? rabbit.sprintSpeed : rabbit.speed;
        if (keys["ArrowRight"] && rabbit.x < canvas.width - rabbit.width) rabbit.x += rabbit.isSprinting ? rabbit.sprintSpeed : rabbit.speed;
    }

    function moveLions() {
        if (!gameRunning) return;
        lions.forEach(lion => {
            lion.y += lion.speed * gameSpeed;
            if (lion.y > canvas.height) {
                lion.y = 0;
                lion.x = Math.random() * canvas.width;
                score += 1 * scoreMultiplier;
                if (score > highScore) highScore = score;
                updateScore();
            }
        });
    }

    function checkCollision(rabbit, lion) {
        return rabbit.x < lion.x + lion.width &&
               rabbit.x + rabbit.width > lion.x &&
               rabbit.y < lion.y + lion.height &&
               rabbit.y + rabbit.height > lion.y;
    }

    function drawRabbit() {
        ctx.drawImage(rabbitImg, rabbit.x, rabbit.y, rabbit.width, rabbit.height);
    }

    function drawLions() {
        lions.forEach(lion => {
            ctx.drawImage(lionImg, lion.x, lion.y, lion.width, lion.height);
        });
    }

    function endGame() {
        gameRunning = false;
        if (score > highScore) highScore = score;
        updateScore();
        setTimeout(() => {
            if (confirm("A lion caught the rabbit! Would you like to start a new game?")) {
                resetGame();
            }
        }, 100);
    }

    function resetGame() {
        score = 0;
        gameSpeed = 1;
        scoreMultiplier = 1;
        rabbit.x = 50;
        rabbit.y = canvas.height - 100;
        gameRunning = true;
        updateScore();
    }

    function startGame() {
        gameRunning = true;
        backgroundMusic.play();
        document.getElementById("startButton").style.display = "none";
    }

    function handleTouchStart(evt) {
        const touch = evt.touches[0];
        touchStartX = touch.clientX;
        touchStartY = touch.clientY;
    }

    function handleTouchMove(evt) {
        if (!touchStartX || !touchStartY) return;

        const touch = evt.touches[0];
        const deltaX = touch.clientX - touchStartX;
        const deltaY = touch.clientY - touchStartY;

        if (Math.abs(deltaX) > Math.abs(deltaY)) {
            // Horizontal swipe
            if (deltaX > 0 && rabbit.x < canvas.width - rabbit.width) {
                keys["ArrowRight"] = true;
                keys["ArrowLeft"] = false;
            } else if (deltaX < 0 && rabbit.x > 0) {
                keys["ArrowLeft"] = true;
                keys["ArrowRight"] = false;
            }
        } else {
            // Vertical swipe
            if (deltaY > 0 && rabbit.y < canvas.height - rabbit.height) {
                keys["ArrowDown"] = true;
                keys["ArrowUp"] = false;
            } else if (deltaY < 0 && rabbit.y > 0) {
                keys["ArrowUp"] = true;
                keys["ArrowDown"] = false;
            }
        }

        touchStartX = touch.clientX;
        touchStartY = touch.clientY;
    }

    function handleTouchEnd() {
        touchStartX = 0;
        touchStartY = 0;
        keys = {};
    }

    function gameLoop() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        if (gameRunning) {
            moveRabbit();
            moveLions();
            drawRabbit();
            drawLions();
            lions.forEach(lion => {
                if (checkCollision(rabbit, lion)) {
                    endGame();
                }
            });
        }
        requestAnimationFrame(gameLoop);
    }

    window.addEventListener("keydown", e => {
        keys[e.key] = true;
        if (e.key === "Shift") rabbit.isSprinting = true;
    });

    window.addEventListener("keyup", e => {
        keys[e.key] = false;
        if (e.key === "Shift") rabbit.isSprinting = false;
    });

    canvas.addEventListener("touchstart", handleTouchStart);
    canvas.addEventListener("touchmove", handleTouchMove);
    canvas.addEventListener("touchend", handleTouchEnd);

    gameLoop();
</script>
</body>
</html>
