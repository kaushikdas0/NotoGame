<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crossy Road - Rabbit vs Lions</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
        }
        canvas {
            display: block;
        }
        #scoreboard {
            position: absolute;
            top: 10px;
            left: 10px;
            font-family: Arial, sans-serif;
            font-size: 20px;
            color: white;
            background: rgba(0, 0, 0, 0.5);
            padding: 10px;
            border-radius: 5px;
        }
        #startButton {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding: 20px;
            font-size: 24px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
        }
        #startButton:hover {
            background-color: #45a049;
        }
    </style>
</head>
<body>
<canvas id="gameCanvas"></canvas>
<div id="scoreboard">
    Score: <span id="score">0</span> | High Score: <span id="highScore">0</span>
    <br><button onclick="resetHighScore()">Reset High Score</button>
</div>

<button id="startButton" onclick="startGame()">Start Game</button>

<audio id="backgroundMusic" src="cyber_monster_world_sound.mp3" loop></audio>

<script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    const rabbitImg = new Image();
    rabbitImg.src = "Anime-style_baby_rabbit_character,_standing_cutely.png";
    
    const lionImg = new Image();
    lionImg.src = "Anime-style_evil_lion_character,_standing_menacing.png";

    let rabbit = { x: 50, y: canvas.height - 100, width: 50, height: 50, speed: 5, sprintSpeed: 12, isSprinting: false };
    
    let lions = [
        { x: 100, y: 0, width: 50, height: 50, speed: 3 },
        { x: 300, y: 0, width: 50, height: 50, speed: 4 },
        { x: 500, y: 0, width: 50, height: 50, speed: 2 }
    ];

    let score = 0, highScore = 0, gameSpeed = 1, scoreMultiplier = 1, gameRunning = false;
    let maxLions = 7;  // Maximum number of lions
    let touchX = rabbit.x, touchY = rabbit.y;
    let backgroundSpeed = 20000;  // Initial background speed (in ms for animation loop)

    const backgroundMusic = document.getElementById("backgroundMusic");

    // Background colors for animation stages
    const backgroundColors = ["#87CEEB", "#4DA1FF", "#001F3F", "#0C0032"];
    let currentBackgroundColorIndex = 0;
    let backgroundAnimationTime = 0;

    function updateScore() {
        document.getElementById('score').textContent = score;
        document.getElementById('highScore').textContent = highScore;
    }

    function resetHighScore() {
        highScore = 0;
        updateScore();
    }

    function moveRabbit() {
        if (!gameRunning) return;

        if (touchX > rabbit.x) rabbit.x += rabbit.speed;
        if (touchX < rabbit.x) rabbit.x -= rabbit.speed;
        if (touchY > rabbit.y) rabbit.y += rabbit.speed;
        if (touchY < rabbit.y) rabbit.y -= rabbit.speed;
    }

    function moveLions() {
        if (!gameRunning) return;
        lions.forEach(lion => {
            lion.y += lion.speed * gameSpeed;
            if (lion.y > canvas.height) {
                lion.y = 0;
                lion.x = Math.random() * canvas.width;
                score += 1 * scoreMultiplier;
                if (score > highScore) highScore = score;
                updateScore();

                if (lions.length < maxLions && score % 10 === 0) {
                    addLion();
                }

                if (score % 10 === 0) {
                    speedUpBackground();
                }
            }
        });
    }

    function addLion() {
        const newLion = {
            x: Math.random() * canvas.width,
            y: 0,
            width: 50,
            height: 50,
            speed: Math.random() * 3 + 2  // Random speed for new lion
        };
        lions.push(newLion);
    }

    function speedUpBackground() {
        if (backgroundSpeed > 5000) {
            backgroundSpeed -= 2000;
        }
    }

    function updateBackground() {
        backgroundAnimationTime += gameSpeed;

        if (backgroundAnimationTime > backgroundSpeed) {
            currentBackgroundColorIndex = (currentBackgroundColorIndex + 1) % backgroundColors.length;
            backgroundAnimationTime = 0;
        }

        ctx.fillStyle = backgroundColors[currentBackgroundColorIndex];
        ctx.fillRect(0, 0, canvas.width, canvas.height);
    }

    function checkCollision(rabbit, lion) {
        return rabbit.x < lion.x + lion.width &&
               rabbit.x + rabbit.width > lion.x &&
               rabbit.y < lion.y + lion.height &&
               rabbit.y + rabbit.height > lion.y;
    }

    function drawRabbit() {
        ctx.drawImage(rabbitImg, rabbit.x, rabbit.y, rabbit.width, rabbit.height);
    }

    function drawLions() {
        lions.forEach(lion => {
            ctx.drawImage(lionImg, lion.x, lion.y, lion.width, lion.height);
        });
    }

    function endGame() {
        gameRunning = false;
        if (score > highScore) highScore = score;
        updateScore();
        setTimeout(() => {
            if (confirm("A lion caught the rabbit! Would you like to start a new game?")) {
                resetGame();
            }
        }, 100);
    }

    function resetGame() {
        score = 0;
        gameSpeed = 1;
        scoreMultiplier = 1;
        rabbit.x = 50;
        rabbit.y = canvas.height - 100;
        lions = [
            { x: 100, y: 0, width: 50, height: 50, speed: 3 },
            { x: 300, y: 0, width: 50, height: 50, speed: 4 },
            { x: 500, y: 0, width: 50, height: 50, speed: 2 }
        ];
        gameRunning = true;
        updateScore();
    }

    function startGame() {
        gameRunning = true;
        backgroundMusic.play();
        document.getElementById("startButton").style.display = "none";
    }

    function handleTouchMove(evt) {
        const touch = evt.touches[0];
        touchX = touch.clientX - rabbit.width; 
        touchY = touch.clientY - rabbit.height * 2; 
    }

    function handleTouchEnd() {
        touchX = rabbit.x;
        touchY = rabbit.y;
    }

    function gameLoop() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        updateBackground(); // Update background with animation

        if (gameRunning) {
            moveRabbit();
            moveLions();
            drawRabbit();
            drawLions();

            lions.forEach(lion => {
                if (checkCollision(rabbit, lion)) {
                    endGame();
                }
            });
        }
        requestAnimationFrame(gameLoop);
    }

    canvas.addEventListener("touchmove", handleTouchMove);
    canvas.addEventListener("touchend", handleTouchEnd);

    gameLoop();
</script>
</body>
</html>
